---
title: "Written Homework 4"
author: "Emma"
date: "2023-05-28"
output: html_document
---
Load packages
```{r}
#Import necessary libraries
library(tidyverse)
library(ISLR2)
library(dplyr)
library(RSpectra)
library(plotly)
```


Load data
```{r}
# Get the current working directory
current_directory <- getwd()

# Specify the file name
file_name <- "KartKross.csv"

# Create the file path
file_path <- file.path(current_directory, file_name)

# Read the CSV file into R
mariokart <- read.csv(file_path)

# Preview data
glimpse(mariokart)

unique(mariokart$kart)
```
Check for NA values
```{r}
# Check for NA values
na_values <- is.na(mariokart)
any(na_values) #There are no NA values
```
Add column indicating bike or car
```{r}
mariokart$bikeorcar <- ifelse(mariokart$kart == "Landship" | mariokart$kart == "Pipe Frame" | mariokart$kart == "Tanooki Kart" | mariokart$kart == "B Dasher" |
                                mariokart$kart == "Sports Coupe" | mariokart$kart == "Koopa Clown" | mariokart$kart == "Mach 8" | mariokart$kart == "Standard ATV"
                              | mariokart$kart == "Streetle" | mariokart$kart == "Mercedes 300 SL Roadster" | mariokart$kart == "Biddybuggy" | mariokart$kart == "Mercedes Silver Arrow"
                              | mariokart$kart == "Prancer" | mariokart$kart == "Steel Driver" | mariokart$kart == "Cat Cruiser" | mariokart$kart == "Wild Wiggler"
                              | mariokart$kart == "Teddy Buggy" | mariokart$kart == "Standard Kart" | mariokart$kart == "Sneeker" | mariokart$kart == "Badwagon"
                              | mariokart$kart == "Mercedes GLA" | mariokart$kart == "P-Wing" | mariokart$kart == "Circuit Special" | mariokart$kart == "Blue Falcon"
                              | mariokart$kart == "Gold Standard", "Car", "Bike")
glimpse(mariokart)
mariokart
```
##Unsupervised learning <br>

#Dimension reduction <br>

Remove factor variables
```{r}
# Concatenate character, kart, tire, and glider columns into a label
labeleddata <- mariokart %>%
  unite(label, characters, kart, tires, glider, sep = ", ")

#Remove factor variables
data <- select(labeleddata, subset = -c("label"))
```

Perform dimension reduction (PCA or SVD?)
```{r}
pr.out <- prcomp(data, scale=TRUE)
```

Plot the proportion of variance in the data that is explained by each principal component.
```{r}
pve <- pr.out$sdev^2/sum(pr.out$sdev^2)
plot(pve, ylab='Proportion of Variance Explained', xlab ='Principal Component', main='Variance by PC in the KartKross Dataset')
```
For the first principal component, speed, acceleration, and turbo are highly weighted.
```{r}
pr.out$rotation[,1] %>% abs() %>% sort(decreasing=TRUE) 
```
For the second principal component, tractions, total, handling, and weight are highly important. 
```{r}
pr.out$rotation[,2] %>% abs() %>% sort(decreasing=TRUE) 
```
The first component seems to describe how fast the cart is, and the second component seems to describe how well it steers. 

Plot a random sample of 100 data points along the first two principle components. 
```{r}

# Create the toplot data frame with the random sample
toplot <- data.frame(pr.out$x)
toplot$label <- labeleddata$label
isCar <- mariokart$bikeorcar
toplot$car <- isCar

# Take a random sample of 100 data points from pr.out
set.seed(1200)
sample_size <- 100
toplot <- toplot[sample(nrow(toplot), sample_size), ]

#Plot sample of 100 data points
fig3 <- plot_ly(data=toplot)
fig3 <- fig3 %>% add_markers(x=~PC1, y = ~PC2, color=~car, text = ~label, hoverinfo = 'text', type='scatter', mode='markers')
fig3 <- fig3 %>% layout(legend=list(title=list(text='Car')))

fig3
```
No apparent groupings of bikes or cars. <br>

Matrix completion?
I believe not necessary due to no NA values

#K-means clustering on pca data

K-means clustering with n = 2 groups and nstart = 20

```{r chunk29}
km.out <- kmeans(pr.out$x, 2, nstart = 20)
```

```{r chunk30}
km.out$cluster
```

The $K$-means clustering perfectly separated the observations into two clusters even though we did not supply any group information to `kmeans()`. We can plot the data, with each observation colored according to its cluster assignment.

```{r chunk31}
plot(pr.out$x, col = (km.out$cluster + 1),
    main = "K-Means Clustering Results with K = 2",
    xlab = "", ylab = "", pch = 20, cex = 2)
```
Do I try multiple nstarts and multiple K-means groups? Do I test accuracy?

Hierarchical clustering?